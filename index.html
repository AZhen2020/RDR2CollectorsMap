
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Red Dead Redemption II Collector Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<style>
    body { margin: 0; font-family: 'Segoe UI';}
    h1 { font-size: 14px }
    p { margin: 0!important; }
    #bar { width: 100%; height: 40px; background: #282828; position: fixed; z-index: 10000; color: #f0f0f0;  text-align: center; line-height: 35px; }
    #map { background: #d2b790; width: 100%; height: 100vh; }
    .input-day { background: #383838; border: none; width: 30px; padding: 5px; color: #f0f0f0; font-family: 'Segoe UI'; font-size: 14px; }
</style>
<body onload="init()">
<div id="bar"><p>Day <input id="day" class="input-day" type="number" min="1" max="3"> / <input class="input-day" type="text" id="search" style="width: 200px;" placeholder="Search items. Separated by ;" autocomplete="off"> </p></div>
<div id="map"></div>
<script>
    var day = 1;
    $('#day').val(day);

    var map;
    var markers = [];
    var markersLayer = new L.LayerGroup();
    var searchTerms = [];

    function init()
    {
        var minZoom = 2;
        var maxZoom = 7;

        // create the map
        map = L.map('map', {
            minZoom: minZoom,
            maxZoom: maxZoom,
            zoomControl: false,
            crs: L.CRS.Simple,
        }).setView([-70, 111.75], 3);

        L.control.zoom({
            position:'bottomright'
        }).addTo(map);

        L.tileLayer('https://s.rsg.sc/sc/images/games/RDR2/map/game/{z}/{x}/{y}.jpg', {
            noWrap: true
        }).addTo(map);

        map.on('click', function(e){
            var coord = e.latlng;
            var lat = coord.lat;
            var lng = coord.lng;
            console.log(`{"day": "${day}","icon": "lost-ring","name": "","desc": "","x": "${lat}","y": "${lng}"},`);
        });

        loadMarkers(map);

    }
    function loadMarkers()
    {

        markers = [];
        $.getJSON("items.json", {}, function(data)
        {
            markers = data;

            addMarkers();
        });

    }

    function addMarkers()
    {
        markersLayer.clearLayers();

        var LeafIcon = L.Icon.extend({
            options: {
                iconSize:     [48, 48],
                shadowSize:   [48, 48],
                iconAnchor:   [24, 48],
                shadowAnchor: [24, 48],
                popupAnchor:  [0, -48]
            }
        });

        $.each(markers, function (key, value)
        {
            if(value.day == day)
            {
                if(searchTerms.length > 0)
                {
                    $.each(searchTerms, function(id, term)
                    {
                        if(value.name.toLowerCase().indexOf(term.toLowerCase()) !== -1)
                        {
                            markersLayer.addLayer(L.marker([value.x, value.y], {icon: new LeafIcon({iconUrl: 'icon/' + value.icon + '.png', shadowUrl: 'icon/day_' + value.day + '.png'})}).bindPopup('<h1>' + value.name + " - Day " + value.day + '</h1><p>' + value.desc + '</p>'));
                        }
                    });
                }
                else
                {
                    markersLayer.addLayer(L.marker([value.x, value.y], {icon: new LeafIcon({iconUrl: 'icon/' + value.icon + '.png', shadowUrl: 'icon/day_' + value.day + '.png'})}).bindPopup('<h1>' + value.name + " - Day " + value.day + '</h1><p>' + value.desc + '</p>'));
                }
            }
        });

        markersLayer.addTo(map);

    }

    $("#day").on("input", function()
    {
        day = $('#day').val();
        addMarkers();
    });

    $("#search").on("input", function()
    {
        searchTerms = [];
        $.each($('#search').val().split(';'), function(key, value)
        {
            if($.inArray(value, searchTerms) == -1)
            {
                if(value.length > 0)
                    searchTerms.push(value);
            }
        });
        addMarkers();
    });
</script>
</body>
</html>
